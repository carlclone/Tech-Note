### 并发减库存 , 防止超卖

减库存根本就不可能并行 , 就像有多个函数同时对一个数减去 10 , 肯定只能串成一条, 区别只在于每个函数调用的时候你是阻塞它还是立刻返回 , 
类似 多路复用 IO , 部分立刻返回失败 , 然后不断轮询 , 减少 CPU 时间浪费

方案 1: 事务 / 行锁

select * .... for update 悲观锁 锁住该行 , 其他请求排队
在脚本中计算出剩余库存
update 库存=脚本计算值 ,如果更新错误则返回失败

方案 2 : 无符号整数

update red_envelope set remain=remain-扣除数量
为负数时报错

性能是方案 1 的 2 倍

方案 3 : 乐观锁 CASE 语句
update 语句就是一条事务 , 这老师是不是理解错了 , 还是得看权威的教程?

方案 4 : 乐观锁 WHERE 语句

